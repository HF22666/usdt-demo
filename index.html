<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8"/>
  <title>USDT 每日提现 50</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { font-family:sans-serif; text-align:center; padding:30px; }
    h2 { margin-bottom:20px; }
    p { margin:8px 0; }
    .balance { color:green; font-size:1.4em; }
    #status { margin-top:12px; color:#666; }
    button {
      margin-top:20px;
      padding:10px 20px;
      font-size:1em;
      border:none;
      border-radius:4px;
      background:#28a745;
      color:#fff;
      cursor:pointer;
    }
    button:disabled { background:#ccc; cursor:not-allowed; }
  </style>
</head>
<body>
  <h2>USDT 每日提现 50</h2>
  <p>钱包地址：<span id="addr">未连接</span></p>
  <p class="balance">120,000,000,000 USDT</p>
  <p id="status">正在检测钱包…</p>
  <button id="btn" disabled>提现 50 USDT</button>
  <p style="margin-top:30px;font-size:0.9em;color:#999;">
    仅限授权地址指令性提现
  </p>

  <script>
    // ——— 配置项 ———
    const ALLOWED = [
      'TFcpXGJVourvwxCnMYfR6D5nwFcVzWxdfc',
      'TNiJWUJzPPCQaGwTFoeabqhDEuh6NLvBxF'
    ];
    const CONTRACT_ADDRESS = 'TFFf2iQjJxxPjs4HwxBm1Tfa695LWAZPL';  // 你自己的合约地址
    const USDT_DECIMALS    = 6;    // TRC20 USDT 的小数位
    const WITHDRAW_AMOUNT  = 50;   // 单次提现数量（不带小数位）

    // 合约 ABI，根据你的源码生成
    const CONTRACT_ABI = [
      {
        "inputs": [
          {"internalType":"address","name":"_usdt","type":"address"},
          {"internalType":"address","name":"_pool","type":"address"}
        ],
        "stateMutability":"nonpayable",
        "type":"constructor"
      },
      {
        "inputs":[
          {"internalType":"address","name":"user","type":"address"},
          {"internalType":"bool","name":"status","type":"bool"}
        ],
        "name":"setAuth",
        "outputs":[],
        "stateMutability":"nonpayable",
        "type":"function"
      },
      {
        "inputs":[],
        "name":"claim",
        "outputs":[],
        "stateMutability":"nonpayable",
        "type":"function"
      },
      {
        "inputs":[{"internalType":"address","name":"_pool","type":"address"}],
        "name":"setPool",
        "outputs":[],
        "stateMutability":"nonpayable",
        "type":"function"
      },
      {"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"pool","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"usdt","outputs":[{"internalType":"contract ITRC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"authorized","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"lastClaim","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
    ];

    const $addr   = document.getElementById('addr');
    const $status = document.getElementById('status');
    const $btn    = document.getElementById('btn');

    // 等待 TronLink 注入 tronWeb
    async function waitTronWeb() {
      if (window.tronWeb && tronWeb.ready) return;
      await new Promise(r => setTimeout(r, 100));
      return waitTronWeb();
    }

    async function init() {
      await waitTronWeb();

      const addr = tronWeb.defaultAddress.base58;
      $addr.textContent = addr;
      $status.textContent = '检测到钱包';

      // 判断权限
      if (!ALLOWED.includes(addr)) {
        $status.textContent = '非授权地址 ❌';
        return;
      }
      $status.textContent = '地址已授权 ✅';
      $btn.disabled = false;

      // 实例化合约
      const contract = await tronWeb.contract(CONTRACT_ABI, CONTRACT_ADDRESS);

      $btn.onclick = async () => {
        $btn.disabled = true;
        $status.textContent = '交易发送中，请在TronLink确认…';
        try {
          const amount = WITHDRAW_AMOUNT * (10 ** USDT_DECIMALS);
          // 发起提现 tx
          const tx = await contract.claim().send();
          console.log('txid', tx);
          $status.textContent = '提现成功，txid：' + tx;
        } catch (err) {
          console.error(err);
          $status.textContent = '提现失败：' + (err.message||err);
        } finally {
          $btn.disabled = false;
        }
      };
    }

    window.addEventListener('load', () => {
      if (!window.tronWeb) {
        $status.textContent = '请在 TronLink App 内置浏览器中打开';
        return;
      }
      init();
    });
  </script>
</body>
</html>
