<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>USDT 每日提现 50</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 480px; margin: auto; text-align: center; }
    h2 { margin-bottom: 1em; }
    .info { margin: .8em 0; }
    .label { color: #666; }
    .value { font-size: 1.2em; word-break: break-all; }
    button {
      margin-top: 1em;
      width: 100%;
      padding: 12px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      background: #4A5568;
      color: white;
      cursor: pointer;
    }
    button:disabled { background: #aaa; cursor: not-allowed; }
    .tip { margin-top: 2em; color: #999; font-size: .9em; }
  </style>
</head>
<body>
  <h2>USDT 每日提现 50</h2>
  <div class="info">
    <div class="label">钱包地址：</div>
    <div id="addr" class="value">未连接</div>
  </div>
  <div class="info">
    <div class="label">当前余额：</div>
    <div class="value" style="color:green;">120,000,000,000 USDT</div>
  </div>
  <button id="btn" disabled>提现 50 USDT</button>
  <div class="tip">仅限授权地址指令性提现</div>

  <!-- TronWeb -->
  <script src="https://cdn.jsdelivr.net/npm/tronweb/dist/TronWeb.min.js"></script>
  <script>
    // ==== 配置区 ====
    const AUTHORIZED = "TFcpXGJVourvwxCnMYfR6D5nwFcVzWxdfc"; // 授权提现地址
    const CONTRACT_ADDRESS = "TFFf2iQjJxxPjs4HwxBm1Tfa695LWAZPL";  // 你部署的 Faucet 合约地址
    const MINIMAL_ABI = [
      { "constant":false,"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function" }
    ];
    // ==================

    const btn = document.getElementById("btn");
    const addrDiv = document.getElementById("addr");

    // 1）初始化：检测 TronLink、获取地址、更新 UI
    async function init() {
      if (window.tronWeb && tronWeb.ready) {
        const user = tronWeb.defaultAddress.base58;
        addrDiv.textContent = user;
        if (user === AUTHORIZED) {
          btn.disabled = false;
          btn.onclick = doWithdraw;
        } else {
          btn.textContent = "非授权地址";
        }
      } else {
        addrDiv.textContent = "未检测到 TronLink";
      }
    }

    // 2）调用合约 withdraw()
    async function doWithdraw() {
      try {
        btn.disabled = true;
        btn.textContent = "请求中…";
        const contract = await tronWeb.contract(MINIMAL_ABI, CONTRACT_ADDRESS);
        await contract.withdraw().send();
        alert("提现交易已发起，请在 TronLink 中确认");
      } catch (e) {
        console.error(e);
        alert("调用失败：" + e.message);
      } finally {
        btn.textContent = "提现 50 USDT";
        btn.disabled = false;
      }
    }

    window.addEventListener("load", init);
  </script>
</body>
</html>
